# Effortless Backend API

FastAPI backend for the Effortless Smart Rewards platform.

## Setup

1. Install dependencies:
   ```bash
   pip install -r requirements.txt
   ```

2. Configure environment variables (see `.env.example`):
   - `OPENAI_API_KEY`: Your OpenAI API key (required for AI features)
   - `DATABASE_URL`: Database connection string (defaults to SQLite)

3. Initialize database and seed data:
   ```bash
   python seed_data.py
   ```

4. Run the server:
   ```bash
   uvicorn app.main:app --reload
   ```

## API Documentation

Once the server is running, visit:
- Swagger UI: `http://localhost:8000/docs`
- ReDoc: `http://localhost:8000/redoc`

## Key Components

### Database Models (`app/models.py`)

- **User**: User profiles linked to Open Finance customer_id
- **UserPreference**: Notification and geo-location preferences
- **Transaction**: Transaction history with enrichment fields
- **Reward**: Merchant offers and Priceless experiences

### Services (`app/services.py`)

- **TransactionEnrichmentService**: Normalizes merchants, infers categories
- **RewardMatchingService**: Matches transactions to available rewards
- **SavingsCalculationService**: Calculates savings from auto-apply and notifications

### AI Service (`app/ai_service.py`)

- **AiInsightsService**: OpenAI integration for insights and recommendations
- Requires `OPENAI_API_KEY` environment variable
- Uses GPT-4 by default (configurable)

## Transaction History Schema

The transaction model follows this exact schema:

- **Date Time Fields**: Posted (by FI) and Transaction date/time fields available.
- **Customer ID**: A number generated by MA Open Banking that uniquely identifies a customer.
- **Account ID**: A number generated by MA Open Banking that uniquely identifies a customer's account: checking, savings, etc.
- **Description + Memo**: Two free text fields, often concatenated by data science, that offer information on merchant, payment processor, geographic location, and transaction type (P2P, P2M, Income, etc).
- **Value Amount**: In USD.

## Open Finance Integration

To integrate with real Open Finance transaction feeds:

1. Import transactions using the `TransactionCreate` schema
2. The `TransactionEnrichmentService` will automatically enrich transactions
3. The `RewardMatchingService` will match transactions to rewards
4. Savings are calculated automatically based on matched rewards

